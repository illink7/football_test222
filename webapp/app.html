<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Squid Survival Football</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&family=Russo+One&display=swap" rel="stylesheet" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    :root {
      --tg-theme-bg-color: #0a1628;
      --tg-theme-text-color: #e0e8f0;
      --tg-theme-button-color: #1a2d4a;
      --tg-theme-button-text-color: #e0e8f0;
      --pitch: #0a1628;
      --ocean-deep: #0f1e35;
      --ocean-dark: #152640;
      --gold: #ffb84d;
      --gold-light: #ffd699;
      --accent: #ff6b6b;
      --success: #4ecdc4;
      --card-bg: rgba(21, 38, 64, 0.9);
      --card-border: rgba(78, 205, 196, 0.3);
      --wood: #1a2332;
      --squid: #6b46c1;
    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Outfit', -apple-system, sans-serif;
      background: var(--pitch);
      background-image: 
        radial-gradient(ellipse at 50% 0%, rgba(78, 205, 196, 0.12) 0%, transparent 50%),
        radial-gradient(ellipse at 20% 80%, rgba(107, 70, 193, 0.08) 0%, transparent 50%),
        linear-gradient(180deg, var(--ocean-dark) 0%, var(--pitch) 100%);
      color: var(--tg-theme-text-color);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .font-title { font-family: 'Russo One', sans-serif; letter-spacing: 0.05em; }
    .container { max-width: 420px; margin: 0 auto; padding: 20px 16px; }
    .header {
      text-align: center;
      padding: 20px 0 24px;
      border-bottom: 1px solid var(--card-border);
    }
    .header h1 { font-size: 1.5rem; margin: 0; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 700; text-shadow: 0 2px 8px rgba(255, 184, 77, 0.3); }
    .header .sub { font-size: 0.85rem; opacity: 0.7; margin-top: 6px; }
    .btn-rules-link {
      display: block; margin: 10px auto 0; padding: 8px 16px;
      font-size: 0.9rem; background: transparent; color: var(--gold-light);
      border: 1px solid var(--gold); border-radius: 8px;
      cursor: pointer; touch-action: manipulation;
    }
    .btn-rules-link:active { opacity: 0.9; }
    .loading { padding: 40px 24px; text-align: center; font-size: 1rem; opacity: 0.9; }
    .error { background: rgba(233,69,96,0.15); color: #e94560; padding: 16px; border-radius: 12px; margin: 16px; text-align: center; white-space: pre-line; }
    .section {
      margin: 24px 0;
    }
    .section-title {
      font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em;
      color: var(--gold-light); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3), 0 0 1px rgba(78, 205, 196, 0.1);
      backdrop-filter: blur(10px);
    }
    .card:last-child { margin-bottom: 0; }
    .header { border-bottom-color: var(--card-border); }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 14px 18px;
      font-size: 1rem;
      font-weight: 500;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.05s;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary { background: var(--accent); color: #fff; border: 1px solid rgba(255,107,107,0.5); box-shadow: 0 4px 16px rgba(255,107,107,0.4), 0 0 1px rgba(255,107,107,0.2); }
    .btn-secondary { background: var(--wood); color: var(--gold-light); border: 1px solid var(--card-border); }
    .btn-success { background: var(--success); color: #0a1628; font-weight: 600; border: 1px solid rgba(78,205,196,0.5); box-shadow: 0 4px 16px rgba(78,205,196,0.4), 0 0 1px rgba(78,205,196,0.2); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    input, textarea, select {
      width: 100%;
      padding: 14px 16px;
      margin-bottom: 12px;
      font-size: 1rem;
      background: rgba(255,255,255,0.08);
      color: var(--tg-theme-text-color);
      border: 1px solid var(--card-border);
      border-radius: 12px;
    }
    input::placeholder, textarea::placeholder { opacity: 0.6; }
    select { cursor: pointer; }
    .form-row { margin-bottom: 12px; }
    .form-row:last-child { margin-bottom: 0; }
    .field-label { font-size: 0.85rem; opacity: 0.9; margin-bottom: 6px; display: block; }
    .hint { font-size: 0.8rem; opacity: 0.7; margin-top: 6px; }
    .balance-line { font-size: 1rem; margin-bottom: 12px; color: var(--gold); }
    .balance-line strong { font-weight: 700; }
    .error-inline { color: #e94560; opacity: 1; }
    .admin-only { display: none; }
    .user-only { display: none; }
    body.admin .admin-only { display: block; }
    body.user .user-only { display: block; }
    .entry-card {
      display: block;
      text-decoration: none;
      color: inherit;
      padding: 18px;
      border-radius: 14px;
      border: 1px solid var(--card-border);
      background: var(--card-bg);
      margin-bottom: 12px;
      transition: background 0.2s, border-color 0.2s, transform 0.1s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .entry-card:active { background: rgba(255,255,255,0.1); transform: scale(0.98); }
    .entry-card .game-name { font-weight: 600; font-size: 1.05rem; margin-bottom: 6px; }
    .entry-card .meta { font-size: 0.85rem; opacity: 0.8; margin-bottom: 12px; }
    .entry-card .cta {
      display: inline-flex; align-items: center; gap: 8px;
      color: var(--gold-light); font-weight: 600; font-size: 0.95rem;
    }
    .entry-card.disabled .cta { color: var(--tg-theme-text-color); opacity: 0.7; }
    .game-card-admin { padding: 14px 16px; }
    .game-card-admin .name { font-weight: 600; margin-bottom: 4px; }
    .game-card-admin .meta { font-size: 0.8rem; opacity: 0.75; }
    .matches-preview {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid var(--card-border);
    }
    .matches-preview .preview-title { font-size: 0.8rem; opacity: 0.8; margin-bottom: 8px; }
    .match-line { font-size: 0.9rem; padding: 4px 0; opacity: 0.95; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .match-line .team-name { display: inline-block; max-width: 45%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .expand-toggle { font-size: 0.85rem; color: var(--accent); cursor: pointer; margin-top: 8px; }

    /* Splash: football animation */
    #splash {
      position: fixed; inset: 0; z-index: 9999;
      background: linear-gradient(180deg, #0a1628 0%, #152640 50%, #0a1628 100%);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: opacity 0.6s ease;
    }
    #splash.hide { opacity: 0; pointer-events: none; }
    .splash-ball {
      width: 80px; height: 80px; font-size: 80px; line-height: 1;
      animation: bounce 0.8s ease-in-out infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-24px) scale(1.05); }
    }
    .splash-title { font-family: 'Russo One', sans-serif; font-size: 1.8rem; color: var(--gold); margin-top: 24px; letter-spacing: 0.05em; text-shadow: 0 2px 12px rgba(255, 184, 77, 0.4); }
    .splash-sub { font-size: 0.9rem; color: var(--gold-light); opacity: 0.9; margin-top: 8px; }

    /* Tabs (user) */
    .tabs-wrap { display: flex; gap: 0; margin: 0 -16px 20px; border-bottom: 2px solid var(--card-border); }
    .tab-btn {
      flex: 1; padding: 14px 16px; font-family: 'Outfit', sans-serif; font-size: 1rem; font-weight: 600;
      background: transparent; color: var(--tg-theme-text-color); opacity: 0.5; border: none; border-bottom: 3px solid transparent;
      cursor: pointer; transition: opacity 0.2s, color 0.2s, border-color 0.2s, background 0.2s;
    }
    .tab-btn.active { 
      opacity: 1; 
      color: var(--gold); 
      border-bottom-color: var(--gold);
      background: rgba(255, 184, 77, 0.1);
      box-shadow: 0 -2px 8px rgba(255, 184, 77, 0.2);
    }
    .tab-btn:active { opacity: 0.9; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    
    /* Rules Modal */
    #rulesModal {
      position: fixed; inset: 0; z-index: 10000;
      background: rgba(10, 22, 40, 0.95);
      backdrop-filter: blur(10px);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 20px;
      opacity: 1; transition: opacity 0.3s ease;
    }
    #rulesModal.hide { opacity: 0; pointer-events: none; }
    .rules-content {
      background: var(--card-bg);
      border: 2px solid var(--gold);
      border-radius: 20px;
      padding: 28px 24px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5), 0 0 20px rgba(255, 184, 77, 0.3);
      text-align: center;
    }
    .rules-content h2 {
      font-family: 'Russo One', sans-serif;
      font-size: 1.5rem;
      color: var(--gold);
      margin: 0 0 20px;
      text-shadow: 0 2px 8px rgba(255, 184, 77, 0.4);
    }
    .rules-list {
      text-align: left;
      margin: 20px 0;
      padding-left: 0;
      list-style: none;
    }
    .rules-list li {
      padding: 10px 0;
      padding-left: 32px;
      position: relative;
      font-size: 0.95rem;
      line-height: 1.5;
      color: var(--tg-theme-text-color);
    }
    .rules-list li::before {
      content: '‚öîÔ∏è';
      position: absolute;
      left: 0;
      font-size: 1.2rem;
    }
    .rules-btn {
      margin-top: 24px;
      width: 100%;
      padding: 16px;
      font-size: 1.1rem;
      font-weight: 700;
      background: var(--success);
      color: #0a1628;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(78,205,196,0.4);
      transition: transform 0.1s, box-shadow 0.2s;
    }
    .rules-btn:active { transform: scale(0.98); }
    .rules-btn:hover { box-shadow: 0 6px 20px rgba(78,205,196,0.5); }
    #rulesCloseBtn { touch-action: manipulation; cursor: pointer; min-height: 48px; }

    /* Deposit choice modal (Tonkeeper / Telegram Wallet) */
    .deposit-choice-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: rgba(10, 22, 40, 0.95);
      backdrop-filter: blur(10px);
      display: flex; align-items: center; justify-content: center;
      padding: 20px;
    }
    .deposit-choice-card {
      background: var(--card-bg);
      border: 2px solid var(--gold);
      border-radius: 20px;
      padding: 24px;
      max-width: 340px;
      width: 100%;
      text-align: center;
    }
    .deposit-choice-title { font-size: 1.25rem; color: var(--gold); margin: 0 0 8px; }
    .deposit-choice-hint { font-size: 0.9rem; opacity: 0.9; margin: 0 0 20px; }
    .deposit-choice-btns { display: flex; flex-direction: column; gap: 12px; }
    .deposit-choice-btn { width: 100%; padding: 16px; font-size: 1rem; font-weight: 600; min-height: 48px; touch-action: manipulation; }
    .deposit-choice-cancel { margin-top: 12px; width: 100%; }
    .deposit-by-address { margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--card-border); text-align: left; }
    .deposit-by-address-title { font-size: 0.85rem; font-weight: 600; color: var(--gold-light); margin-bottom: 10px; }
    .deposit-by-address-row { margin-bottom: 10px; }
    .deposit-by-address-row label { display: block; font-size: 0.8rem; opacity: 0.9; margin-bottom: 4px; }
    .deposit-addr, .deposit-memo { display: block; font-size: 0.75rem; word-break: break-all; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 8px; margin-bottom: 6px; }
    .deposit-by-address-row .btn-small { padding: 6px 12px; font-size: 0.85rem; width: auto; margin-top: 4px; }
    .deposit-by-address-note { font-size: 0.8rem; opacity: 0.85; margin: 10px 0 0; }
    
    /* Balance in bets section */
    .bets-balance-card {
      background: linear-gradient(135deg, var(--card-bg) 0%, rgba(21, 38, 64, 0.95) 100%);
      border: 2px solid var(--gold);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(255, 184, 77, 0.2), 0 0 1px rgba(255, 184, 77, 0.3);
    }
    .bets-balance-label {
      font-size: 0.9rem;
      color: var(--gold-light);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 8px;
    }
    .bets-balance-value {
      font-family: 'Russo One', sans-serif;
      font-size: 2.8rem;
      color: var(--gold);
      text-shadow: 0 2px 12px rgba(255, 184, 77, 0.4);
      margin: 8px 0;
    }
    .bets-balance-zero {
      font-size: 0.9rem;
      color: var(--accent);
      margin-top: 12px;
      padding: 12px;
      background: rgba(255, 107, 107, 0.1);
      border-radius: 10px;
      border: 1px solid rgba(255, 107, 107, 0.3);
    }

    /* Profile */
    .profile-balance-card {
      background: linear-gradient(135deg, var(--card-bg) 0%, rgba(44, 24, 16, 0.9) 100%);
      border: 2px solid var(--gold);
      border-radius: 16px; padding: 24px; text-align: center; margin-bottom: 20px;
      box-shadow: 0 0 20px rgba(212, 168, 75, 0.15);
    }
    .profile-balance-label { font-size: 0.85rem; color: var(--gold-light); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px; }
    .profile-balance-value { font-family: 'Russo One', sans-serif; font-size: 2.5rem; color: var(--gold); text-shadow: 0 2px 12px rgba(255, 184, 77, 0.4); }
    .profile-balance-value span { font-size: 1rem; opacity: 0.9; margin-left: 4px; }
    .profile-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
    .profile-actions .btn { font-size: 0.9rem; padding: 12px; }
    .profile-actions .btn:disabled { opacity: 0.7; cursor: default; }
    .history-item {
      padding: 14px 16px; margin-bottom: 10px; border-radius: 12px;
      background: var(--card-bg); border: 1px solid var(--card-border);
      display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;
    }
    .history-item.win { border-left: 4px solid var(--success); }
    .history-item.loss { border-left: 4px solid var(--accent); }
    .history-item.active { border-left: 4px solid var(--gold); box-shadow: 0 0 8px rgba(255,184,77,0.2); }
    .history-game { font-weight: 600; font-size: 1rem; }
    .history-meta { font-size: 0.85rem; opacity: 0.85; }
    .history-result { font-weight: 600; font-size: 0.95rem; }
    .history-result.win { color: var(--success); }
    .history-result.loss { color: var(--accent); }
    .history-result.active { color: var(--gold); }
    .soon { font-size: 0.75rem; opacity: 0.8; font-weight: normal; }
    .quick-league-btns { display: flex; flex-direction: column; gap: 10px; }
    .btn-quick-league { margin-top: 0; font-size: 0.95rem; padding: 12px 16px; background: var(--wood); color: var(--gold-light); border: 1px solid var(--card-border); }
    .btn-quick-league:active { background: rgba(212, 168, 75, 0.2); }
    .achievements-wrap { display: flex; flex-wrap: wrap; gap: 10px; }
    .achievement-badge {
      display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 12px;
      background: var(--card-bg); border: 1px solid var(--card-border); font-size: 0.9rem;
    }
    .achievement-badge.locked { opacity: 0.5; }
    .achievement-badge .icon { font-size: 1.2rem; }
    .wallet-addr { font-family: monospace; font-size: 0.85rem; word-break: break-all; color: var(--gold-light); }
    .wallet-card { margin-top: 16px; }
    .ton-connect-btn { width: 100%; }
  </style>
</head>
<body>
  <div id="splash">
    <div class="splash-ball" aria-hidden="true">‚öΩ</div>
      <div class="splash-title font-title">ü¶ë Squid Survival Football</div>
  </div>

  <!-- Rules Modal (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ showRulesIfNeeded) -->
  <div id="rulesModal" style="display: none;">
    <div class="rules-content">
      <h2>ü¶ë –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
      <ul class="rules-list">
        <li>–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤ USDT –≤ —Ä–∞–∑–¥–µ–ª–µ –ü—Ä–æ—Ñ–∏–ª—å</li>
        <li>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É (0.1‚Äì5 USDT –Ω–∞ –±–∏–ª–µ—Ç)</li>
        <li>–î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∏–ª–µ—Ç–∞ –≤—ã–±–µ—Ä–∏—Ç–µ 2 –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–±—å—é—Ç</li>
        <li>–ï—Å–ª–∏ –æ–±–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–±–∏–ª–∏ ‚Äî –≤–∞—à –±–∏–ª–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –¥–∞–ª—å—à–µ</li>
        <li>–°—Ç–∞–≤–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 1.5 —Ä–∞–∑–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç—É—Ä–∞</li>
        <li>–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω —Ç—É—Ä</li>
        <li>–í —Å–ª–µ–¥—É—é—â–∏—Ö —Ç—É—Ä–∞—Ö –Ω–µ–ª—å–∑—è –≤—ã–±–∏—Ä–∞—Ç—å —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</li>
        <li>–ó–∞–±–µ—Ä–∏—Ç–µ –≤—ã–∏–≥—Ä—ã—à –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –∏–ª–∏ –∏–≥—Ä–∞–π—Ç–µ –¥–æ –∫–æ–Ω—Ü–∞</li>
      </ul>
      <button type="button" class="rules-btn" id="rulesCloseBtn">–ü–æ–Ω—è—Ç–Ω–æ, –Ω–∞—á–∞—Ç—å!</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
  <div id="depositChoiceModal" class="deposit-choice-overlay" style="display: none;">
    <div class="deposit-choice-card">
      <h3 class="deposit-choice-title">–°–ø–æ—Å–æ–± –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
      <p class="deposit-choice-hint">–û–±–µ—Ä—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å –∞–±–æ –ø–µ—Ä–µ–∫–∞–∂—ñ—Ç—å –ø–æ –∞–¥—Ä–µ—Å—ñ</p>
      <div class="deposit-choice-btns">
        <button type="button" class="btn deposit-choice-btn" id="depositBtnTonkeeper">Tonkeeper</button>
        <button type="button" class="btn deposit-choice-btn" id="depositBtnTelegram">Telegram Wallet</button>
      </div>
      <div class="deposit-by-address">
        <div class="deposit-by-address-title">–ü–æ –∞–¥—Ä–µ—Å—É (–±—É–¥—å-—è–∫–∏–π –≥–∞–º–∞–Ω–µ—Ü—å)</div>
        <div class="deposit-by-address-row">
          <label>–ê–¥—Ä–µ—Å–∞:</label>
          <code id="depositModalAddress" class="deposit-addr"></code>
          <button type="button" class="btn btn-small" id="depositCopyAddress">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <div class="deposit-by-address-row">
          <label>Memo (–∫–æ–º–µ–Ω—Ç–∞—Ä):</label>
          <code id="depositModalMemo" class="deposit-memo"></code>
          <button type="button" class="btn btn-small" id="depositCopyMemo">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        </div>
        <p class="deposit-by-address-note">–ü–µ—Ä–µ–∫–∞–∂—ñ—Ç—å USDT –Ω–∞ –∞–¥—Ä–µ—Å—É –∑ —Ü–∏–º memo ‚Äî –±–∞–ª–∞–Ω—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</p>
      </div>
      <button type="button" class="btn btn-secondary deposit-choice-cancel" id="depositChoiceCancel">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
  </div>

  <div class="container" id="mainContainer" style="opacity:0; transition: opacity 0.5s ease;">
    <header class="header">
      <h1 class="font-title" style="color: var(--gold); font-size: 1.75rem;">ü¶ë Squid Survival Football</h1>
      <p class="sub">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç—á–∏ –∏ –∂–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
      <button type="button" class="btn-rules-link" id="btnShowRules">üìú –ü—Ä–∞–≤–∏–ª–∞</button>
    </header>

    <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
    <div id="error" class="error" style="display:none;"></div>

    <div id="admin" class="admin-only">
      <section class="section">
        <h2 class="section-title">üèÜ –ù–æ–≤–∞—è –∏–≥—Ä–∞</h2>
        <div class="card">
          <input type="text" id="newGameTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–µ–º—å–µ—Ä-–ª–∏–≥–∞)" />
          <button type="button" id="btnCreateGame" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">üéÆ –í–∞—à–∏ –∏–≥—Ä—ã</h2>
        <div id="gamesList"></div>
      </section>

      <section class="section">
        <h2 class="section-title">üá©üá™ –ë—É–Ω–¥–µ—Å–ª–∏–≥–∞ (BL1)</h2>
        <div class="card">
          <p class="hint">–ü–æ–¥—Ç—è–Ω—É—Ç—å —Ç–µ–∫—É—â–∏–π —Ç—É—Ä –∏–∑ <a href="https://www.football-data.org/" target="_blank" rel="noopener">Football-Data.org</a>. –ù—É–∂–µ–Ω API –∫–ª—é—á (FOOTBALL_DATA_API_KEY). –°–æ–∑–¥–∞—Å—Ç—Å—è –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è –∏–≥—Ä–∞ ¬´Bundesliga¬ª –∏ –º–∞—Ç—á–∏ —Ç–µ–∫—É—â–µ–≥–æ —Ç—É—Ä–∞.</p>
          <p id="fetchBl1Error" class="hint error-inline" style="display:none;"></p>
          <button type="button" id="btnFetchBundesliga" class="btn btn-primary">–ü–æ–¥—Ç—è–Ω—É—Ç—å —Ç—É—Ä –ë—É–Ω–¥–µ—Å–ª–∏–≥–∏</button>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">‚öΩ –ó–∞–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 10 —Ç—É—Ä–æ–≤</h2>
        <div class="card">
          <div class="form-row">
            <label class="field-label">1. –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</label>
            <select id="setTeamsGameId"><option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ‚Äî</option></select>
          </div>
          <div class="form-row">
            <label class="field-label">2. –ë—ã—Å—Ç—Ä—ã–µ –ª–∏–≥–∏ ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å 20 –∫–æ–º–∞–Ω–¥</label>
            <div class="quick-league-btns">
              <button type="button" class="btn btn-quick-league" id="btnLeagueEPL">üè¥ –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –ü—Ä–µ–º—å–µ—Ä-–ª–∏–≥–∞</button>
              <button type="button" class="btn btn-quick-league" id="btnLeagueLaLiga">üá™üá∏ –õ–∞ –õ–∏–≥–∞</button>
            </div>
          </div>
          <div class="form-row">
            <label class="field-label">3. –°–ø–∏—Å–æ–∫ 20 –∫–æ–º–∞–Ω–¥ (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
            <textarea id="setTeamsText" rows="12" placeholder="–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ª–∏–≥–∏ –≤—ã—à–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é..."></textarea>
          </div>
          <p class="hint">–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 10 —Ç—É—Ä–æ–≤ –ø–æ 10 –º–∞—Ç—á–µ–π (–ø–∞—Ä—ã —Ç–∞—Å—É—é—Ç—Å—è –∫–∞–∂–¥—ã–π —Ç—É—Ä). –°—Ç–∞—Ä—ã–µ –º–∞—Ç—á–∏ –∏–≥—Ä—ã –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.</p>
          <p id="setTeamsError" class="hint error-inline" style="display:none;"></p>
          <button type="button" id="btnSetTeams" class="btn btn-success">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 10 —Ç—É—Ä–æ–≤</button>
          <div id="setTeamsPreview" class="matches-preview" style="display:none;"></div>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">üìã –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á–∏ –≤—Ä—É—á–Ω—É—é (–æ–¥–∏–Ω —Ä–∞—É–Ω–¥)</h2>
        <div class="card">
          <div class="form-row">
            <label class="field-label">–ò–≥—Ä–∞</label>
            <select id="addMatchGameId"><option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ‚Äî</option></select>
          </div>
          <div class="form-row">
            <label class="field-label">–ù–æ–º–µ—Ä —Ä–∞—É–Ω–¥–∞</label>
            <input type="number" id="addMatchRound" placeholder="–ù–æ–º–µ—Ä —Ä–∞—É–Ω–¥–∞" min="1" value="1" />
          </div>
          <div class="form-row">
            <label class="field-label">–ú–∞—Ç—á–∏ (–æ–¥–∏–Ω –Ω–∞ —Å—Ç—Ä–æ–∫—É: –î–æ–º–∞ ‚Äî –ì–æ—Å—Ç—å)</label>
            <textarea id="addMatchText" rows="6" placeholder="–í—É–ª–≤–µ—Ä—Ö—ç–º–ø—Ç–æ–Ω ‚Äî –ê—Ä—Å–µ–Ω–∞–ª&#10;–ë–æ—Ä–Ω–º—É—Ç ‚Äî –ú–∞–Ω –Æ–Ω–∞–π—Ç–µ–¥&#10;..."></textarea>
          </div>
          <p id="addMatchError" class="hint error-inline" style="display:none;"></p>
          <button type="button" id="btnAddMatches" class="btn btn-secondary">–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á–∏</button>
          <div id="matchesAddedPreview" class="matches-preview" style="display:none;"></div>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">üí∞ –†—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞ USDT</h2>
        <div class="card">
          <p class="hint">–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–∏–ª USDT, –Ω–æ –±–∞–ª–∞–Ω—Å –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ.</p>
          <div class="form-row">
            <label class="field-label">Transaction ID (–∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è)</label>
            <input type="text" id="adminConfirmTxId" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: a1b2c3d4-..." />
          </div>
          <div class="form-row">
            <label class="field-label">Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="number" id="adminConfirmUserId" placeholder="8386941234" />
          </div>
          <div class="form-row">
            <label class="field-label">–°—É–º–º–∞ (USDT)</label>
            <input type="number" id="adminConfirmAmount" placeholder="1.5" step="0.01" min="0.1" />
          </div>
          <p id="adminConfirmError" class="hint error-inline" style="display:none;"></p>
          <p id="adminConfirmSuccess" class="hint" style="display:none; color: var(--success);"></p>
          <button type="button" id="btnAdminConfirmDeposit" class="btn btn-success">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ USDT</button>
        </div>
      </section>
    </div>

    <div id="user" class="user-only">
      <nav class="tabs-wrap" aria-label="–†–∞–∑–¥–µ–ª—ã">
        <button type="button" class="tab-btn active" data-tab="bets" id="tabBets">‚öΩ –°—Ç–∞–≤–∫–∏</button>
        <button type="button" class="tab-btn" data-tab="profile" id="tabProfile">üè¥‚Äç‚ò†Ô∏è –ü—Ä–æ—Ñ–∏–ª—å</button>
      </nav>
      <div id="panelBets" class="tab-panel active">
        <section class="section" id="joinSection">
          <div class="bets-balance-card" id="betsBalanceCard">
            <div class="bets-balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
            <div class="bets-balance-value" id="betsBalanceValue">‚Äî</div>
            <div id="balanceZeroMessage" class="bets-balance-zero" style="display:none;">
              üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å (USDT) –≤ —Ä–∞–∑–¥–µ–ª–µ <strong>–ü—Ä–æ—Ñ–∏–ª—å</strong>
            </div>
          </div>
          <h2 class="section-title">üéØ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ</h2>
          <div class="card" id="joinCard">
            <div class="form-row">
              <label class="field-label">–ò–≥—Ä–∞</label>
              <select id="joinGameId"><option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ‚Äî</option></select>
            </div>
            <div class="form-row">
              <label class="field-label">–°—É–º–º–∞ –Ω–∞ –æ–¥–∏–Ω –±–∏–ª–µ—Ç (USDT)</label>
              <select id="joinStake">
                <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É ‚Äî</option>
              </select>
            </div>
            <div class="form-row">
              <label class="field-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤ (—Å—Ç–∞–≤–æ–∫)</label>
              <select id="joinNumTickets">
                <option value="1">1 –±–∏–ª–µ—Ç</option>
                <option value="2">2 –±–∏–ª–µ—Ç–∞</option>
                <option value="3">3 –±–∏–ª–µ—Ç–∞</option>
                <option value="4">4 –±–∏–ª–µ—Ç–∞</option>
                <option value="5">5 –±–∏–ª–µ—Ç–æ–≤</option>
              </select>
            </div>
            <button type="button" id="btnJoin" class="btn btn-primary">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
          </div>
        </section>
        <section class="section">
          <h2 class="section-title">üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏</h2>
          <div id="entriesList"></div>
          <p class="hint">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –≤—ã—à–µ, —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è¬ª.</p>
        </section>
      </div>
      <div id="panelProfile" class="tab-panel">
        <section class="section">
          <h2 class="section-title">üí∞ –ë–∞–ª–∞–Ω—Å</h2>
          <div class="profile-balance-card">
            <div class="profile-balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
            <div class="profile-balance-value" id="profileBalanceValue">‚Äî <span>USDT</span></div>
          </div>
          <div class="card" id="walletCard">
            <div id="walletNotConnected">
              <p class="hint">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ TON –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –≤—ã–≤–æ–¥–∞ –±–∞–ª–∞–Ω—Å–∞</p>
              <button type="button" class="btn btn-primary" id="btnConnectWallet">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å TON –∫–æ—à–µ–ª–µ–∫</button>
            </div>
            <div id="walletConnected" style="display:none;">
              <p class="hint">–ö–æ—à–µ–ª–µ–∫: <span id="walletAddress" class="wallet-addr"></span></p>
              <button type="button" class="btn btn-secondary" id="btnDisconnectWallet">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
            </div>
          </div>
          <div class="profile-actions">
            <button type="button" class="btn btn-success" id="btnAddBalance">üíµ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
            <button type="button" class="btn btn-secondary" id="btnWithdraw">üí∏ –í—ã–≤–µ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å</button>
          </div>
        </section>
        <section class="section">
          <h2 class="section-title">üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
          <div id="profileAchievements" class="achievements-wrap"></div>
        </section>
        <section class="section">
          <h2 class="section-title">üìú –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫</h2>
          <div id="profileHistory"></div>
        </section>
      </div>
    </div>
  </div>

  <script>
(function () {
  const tg = window.Telegram?.WebApp;
  if (tg) tg.ready();

  const baseUrl = window.location.origin;
  let initData = (tg && tg.initData) ? tg.initData : '';

  function qs() { return 'init_data=' + encodeURIComponent(initData); }
  function authHeaders(extra = {}) {
    const h = { ...extra };
    if (initData) h['X-Telegram-Init-Data'] = initData;
    return h;
  }

  const loadingEl = document.getElementById('loading');
  const errorEl = document.getElementById('error');

  var LEAGUE_EPL = [
    '–ê—Ä—Å–µ–Ω–∞–ª', '–ú–∞–Ω—á–µ—Å—Ç–µ—Ä –°–∏—Ç–∏', '–ê—Å—Ç–æ–Ω –í–∏–ª–ª–∞', '–ú–∞–Ω—á–µ—Å—Ç–µ—Ä –Æ–Ω–∞–π—Ç–µ–¥', '–ß–µ–ª—Å–∏', '–õ–∏–≤–µ—Ä–ø—É–ª—å',
    '–ë—Ä–µ–Ω—Ç—Ñ–æ—Ä–¥', '–≠–≤–µ—Ä—Ç–æ–Ω', '–ë–æ—Ä–Ω–º—É—Ç', '–ù—å—é–∫–∞—Å–ª', '–°–∞–Ω–¥–µ—Ä–ª–µ–Ω–¥', '–§—É–ª—Ö—ç–º', '–ö—Ä–∏—Å—Ç–∞–ª –ü—ç–ª–∞—Å',
    '–ë—Ä–∞–π—Ç–æ–Ω', '–õ–∏–¥—Å –Æ–Ω–∞–π—Ç–µ–¥', '–¢–æ—Ç—Ç–µ–Ω—Ö—ç–º', '–ù–æ—Ç—Ç–∏–Ω–≥–µ–º –§–æ—Ä–µ—Å—Ç', '–í–µ—Å—Ç –•—ç–º', '–ë–µ—Ä–Ω–ª–∏', '–í—É–ª–≤–µ—Ä—Ö—ç–º–ø—Ç–æ–Ω'
  ];
  var LEAGUE_LALIGA = [
    '–†–µ–∞–ª –ú–∞–¥—Ä–∏–¥', '–ë–∞—Ä—Å–µ–ª–æ–Ω–∞', '–í–∏–ª—å—è—Ä—Ä–µ–∞–ª', '–ê—Ç–ª–µ—Ç–∏–∫–æ –ú–∞–¥—Ä–∏–¥', '–ë–µ—Ç–∏—Å', '–≠—Å–ø–∞–Ω—å–æ–ª', '–°–µ–ª—å—Ç–∞',
    '–†–µ–∞–ª –°–æ—Å—å–µ–¥–∞–¥', '–ê—Ç–ª–µ—Ç–∏–∫', '–û—Å–∞—Å—É–Ω–∞', '–•–µ—Ç–∞—Ñ–µ', '–°–µ–≤–∏–ª—å—è', '–ê–ª–∞–≤–µ—Å', '–í–∞–ª–µ–Ω—Å–∏—è', '–ñ–∏—Ä–æ–Ω–∞',
    '–≠–ª—å—á–µ', '–†–∞–π–æ –í–∞–ª—å–µ–∫–∞–Ω–æ', '–ú–∞–ª—å–æ—Ä–∫–∞', '–õ–µ–≤–∞–Ω—Ç–µ', '–†–µ–∞–ª –û–≤—å–µ–¥–æ'
  ];

  function showError(msg) {
    errorEl.textContent = msg;
    errorEl.style.display = 'block';
    loadingEl.style.display = 'none';
  }

  function switchTab(tabName) {
    document.querySelectorAll('.tab-btn').forEach(function (btn) {
      btn.classList.toggle('active', btn.dataset.tab === tabName);
    });
    document.getElementById('panelBets').classList.toggle('active', tabName === 'bets');
    document.getElementById('panelProfile').classList.toggle('active', tabName === 'profile');
  }

  function renderProfileHistory(entries) {
    const el = document.getElementById('profileHistory');
    if (!el) return;
    if (!entries || !entries.length) {
      el.innerHTML = '<p class="hint">–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —É—á–∞—Å—Ç–∏—è –≤ –∏–≥—Ä–∞—Ö.</p>';
      return;
    }
    el.innerHTML = entries.map(function (e) {
      let resultClass = 'active';
      let resultText = '–í –∏–≥—Ä–µ';
      if (e.status === 'cashed_out') {
        resultClass = 'win';
        resultText = '+ ' + (e.stake != null ? (Number(e.stake) % 1 === 0 ? e.stake : Number(e.stake).toFixed(2)) : '‚Äî') + ' USDT';
      } else if (e.status === 'out') {
        resultClass = 'loss';
        resultText = '–í—ã–±—ã–ª';
      }
      const stakeStr = e.stake != null ? ' –°—Ç–∞–≤–∫–∞: ' + (Number(e.stake) % 1 === 0 ? e.stake : Number(e.stake).toFixed(2)) + ' USDT' : '';
      return '<div class="history-item ' + resultClass + '">' +
        '<div><div class="history-game">' + escapeHtml(e.game_title) + '</div>' +
        '<div class="history-meta">–†–∞—É–Ω–¥ ' + e.current_round + ' / ' + e.rounds_total + stakeStr + '</div></div>' +
        '<span class="history-result ' + resultClass + '">' + escapeHtml(resultText) + '</span>' +
      '</div>';
    }).join('');
  }

  let tonConnectUI = null;
  let userWalletAddress = null;

  function initTonConnect() {
    if (typeof TON_CONNECT_UI === 'undefined') {
      console.warn('TON Connect UI not loaded, retrying...');
      setTimeout(initTonConnect, 1000);
      return;
    }
    try {
      tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: baseUrl + '/tonconnect-manifest.json',
      });
      tonConnectUI.onStatusChange(function (wallet) {
        if (wallet && wallet.account) {
          userWalletAddress = wallet.account.address;
          handleWalletConnected(wallet.account.address);
        } else {
          userWalletAddress = null;
          handleWalletDisconnected();
        }
      });
      tonConnectUI.restoreConnection();
    } catch (e) {
      console.error('TON Connect init error:', e);
    }
  }

  function handleWalletConnected(address) {
    document.getElementById('walletNotConnected').style.display = 'none';
    document.getElementById('walletConnected').style.display = 'block';
    document.getElementById('walletAddress').textContent = address.substring(0, 6) + '...' + address.substring(address.length - 6);
    connectWalletToBackend(address);
  }

  function handleWalletDisconnected() {
    document.getElementById('walletNotConnected').style.display = 'block';
    document.getElementById('walletConnected').style.display = 'none';
    disconnectWalletFromBackend();
  }

  async function connectWalletToBackend(address) {
    try {
      var r = await fetch(baseUrl + '/api/connect_wallet', {
        method: 'POST',
        headers: authHeaders({ 'Content-Type': 'application/json' }),
        body: JSON.stringify({ wallet_address: address })
      });
      var data = await r.json().catch(function () { return {}; });
      if (!r.ok) {
        if (tg) tg.showAlert(data.detail || '–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≥–∞–º–∞–Ω—Ü—è');
      }
    } catch (e) {
      console.error('Connect wallet error:', e);
    }
  }

  async function disconnectWalletFromBackend() {
    try {
      await fetch(baseUrl + '/api/disconnect_wallet', {
        method: 'POST',
        headers: authHeaders()
      });
    } catch (e) {
      console.error('Disconnect wallet error:', e);
    }
  }

  function showContent(me) {
    loadingEl.style.display = 'none';
    errorEl.style.display = 'none';
    document.body.classList.add(me.is_admin ? 'admin' : 'user');

    if (me.is_admin) {
      fillGamesSelects(me.games || []);
      renderGamesList(me.games || []);
      document.getElementById('btnCreateGame').onclick = createGame;
      document.getElementById('btnSetTeams').onclick = setTeams;
      document.getElementById('btnAddMatches').onclick = addMatches;
      document.getElementById('btnLeagueEPL').onclick = function () {
        document.getElementById('setTeamsText').value = LEAGUE_EPL.join('\n');
        if (tg) tg.showAlert('–í—Å—Ç–∞–≤–ª–µ–Ω–æ 20 –∫–æ–º–∞–Ω–¥ –ê–Ω–≥–ª–∏–π—Å–∫–æ–π –ü—Ä–µ–º—å–µ—Ä-–ª–∏–≥–∏. –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 10 —Ç—É—Ä–æ–≤¬ª.');
      };
      document.getElementById('btnLeagueLaLiga').onclick = function () {
        document.getElementById('setTeamsText').value = LEAGUE_LALIGA.join('\n');
        if (tg) tg.showAlert('–í—Å—Ç–∞–≤–ª–µ–Ω–æ 20 –∫–æ–º–∞–Ω–¥ –õ–∞ –õ–∏–≥–∏. –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 10 —Ç—É—Ä–æ–≤¬ª.');
      };
      document.getElementById('btnFetchBundesliga').onclick = fetchBundesligaRound;
      var btnAdminConfirm = document.getElementById('btnAdminConfirmDeposit');
      if (btnAdminConfirm) btnAdminConfirm.onclick = adminConfirmDeposit;
    } else {
      const balance = me.balance != null ? Number(me.balance) : 0;
      const betsBalanceEl = document.getElementById('betsBalanceValue');
      if (betsBalanceEl) {
        betsBalanceEl.textContent = balance % 1 === 0 ? balance : Number(balance).toFixed(2);
      }
      const balanceZeroMsg = document.getElementById('balanceZeroMessage');
      if (balanceZeroMsg) {
        balanceZeroMsg.style.display = balance === 0 ? 'block' : 'none';
      }
      var pv = document.getElementById('profileBalanceValue');
      if (pv) { pv.innerHTML = (balance % 1 === 0 ? balance : Number(balance).toFixed(2)) + ' <span>USDT</span>'; }
      fillStakeSelect(balance);
      fillJoinGameSelect(me.games || []);
      document.getElementById('btnJoin').onclick = joinGame;
      renderEntriesList(me.entries || [], me.games || []);
      renderProfileHistory(me.entries || []);
      renderAchievements(me.achievements || []);
      document.getElementById('tabBets').onclick = function () { switchTab('bets'); };
      document.getElementById('tabProfile').onclick = function () { switchTab('profile'); };
      initTonConnect();
      if (me.ton_wallet_address) {
        userWalletAddress = me.ton_wallet_address;
        handleWalletConnected(me.ton_wallet_address);
      }
      document.getElementById('btnConnectWallet').onclick = function () {
        if (tonConnectUI) {
          tonConnectUI.openModal();
        } else {
          if (tg) tg.showAlert('TON Connect –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        }
      };
      document.getElementById('btnDisconnectWallet').onclick = function () {
        if (tonConnectUI) {
          tonConnectUI.disconnect();
        }
      };
      document.getElementById('btnAddBalance').onclick = function () {
        if (!userWalletAddress) {
          if (tg) tg.showAlert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ TON –∫–æ—à–µ–ª–µ–∫');
          return;
        }
        showDepositDialog();
      };
      document.getElementById('btnWithdraw').onclick = function () {
        if (!userWalletAddress) {
          if (tg) tg.showAlert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ TON –∫–æ—à–µ–ª–µ–∫');
          return;
        }
        showWithdrawDialog();
      };
    }
  }

  function showDepositDialog() {
    var amount = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (USDT):');
    if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
      if (tg) tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
      return;
    }
    requestDeposit(parseFloat(amount));
  }

  function showWithdrawDialog() {
    var amount = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤—ã–≤–æ–¥–∞ (USDT):');
    if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
      if (tg) tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
      return;
    }
    requestWithdraw(parseFloat(amount));
  }

  function openDepositLink(link) {
    if (tg && tg.openLink) tg.openLink(link);
    else window.open(link, '_blank');
  }
  function copyToClipboard(text, msg) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(function () {
        if (tg) tg.showAlert(msg || '–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
        else alert(msg || '–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
      }).catch(function () {
        if (tg) tg.showAlert('–°–∫–æ–ø—ñ—é–π—Ç–µ –≤—Ä—É—á–Ω—É: ' + text.slice(0, 30) + '‚Ä¶');
        else alert('–°–∫–æ–ø—ñ—é–π—Ç–µ –≤—Ä—É—á–Ω—É: ' + text);
      });
    } else {
      if (tg) tg.showAlert('–°–∫–æ–ø—ñ—é–π—Ç–µ –≤—Ä—É—á–Ω—É –∑ –±–ª–æ–∫—É ¬´–ü–æ –∞–¥—Ä–µ—Å—É¬ª –Ω–∏–∂—á–µ');
      else alert('–°–∫–æ–ø—ñ—é–π—Ç–µ –≤—Ä—É—á–Ω—É: ' + text);
    }
  }
  (function initDepositChoiceModal() {
    var modal = document.getElementById('depositChoiceModal');
    var btnTk = document.getElementById('depositBtnTonkeeper');
    var btnTg = document.getElementById('depositBtnTelegram');
    var btnCancel = document.getElementById('depositChoiceCancel');
    var btnCopyAddr = document.getElementById('depositCopyAddress');
    var btnCopyMemo = document.getElementById('depositCopyMemo');
    if (!modal || !btnTk || !btnTg) return;
    function closeDepositModal() { modal.style.display = 'none'; }
    btnTk.addEventListener('click', function () {
      var d = window._depositLinks;
      if (d && d.tk) openDepositLink(d.tk);
      closeDepositModal();
    });
    btnTg.addEventListener('click', function () {
      var d = window._depositLinks;
      if (!d) return;
      if (d.wallet) {
        copyToClipboard(d.wallet, '–ê–¥—Ä–µ—Å—É —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Wallet –≤ Telegram ‚Üí –ü–µ—Ä–µ–∫–∞–∑ ‚Üí –≤—Å—Ç–∞–≤—Ç–µ –∞–¥—Ä–µ—Å—É. Memo —Å–∫–æ–ø—ñ—é–π—Ç–µ –∫–Ω–æ–ø–∫–æ—é –Ω–∏–∂—á–µ.');
      }
      if (d.tg) {
        try { openDepositLink(d.tg); } catch (e) {}
      }
    });
    if (btnCopyAddr) btnCopyAddr.addEventListener('click', function () {
      var d = window._depositLinks;
      if (d && d.wallet) copyToClipboard(d.wallet, '–ê–¥—Ä–µ—Å—É —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
    });
    if (btnCopyMemo) btnCopyMemo.addEventListener('click', function () {
      var d = window._depositLinks;
      if (d && d.comment) copyToClipboard(d.comment, 'Memo —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
    });
    if (btnCancel) btnCancel.addEventListener('click', closeDepositModal);
  })();

  async function requestDeposit(amount) {
    try {
      var r = await fetch(baseUrl + '/api/deposit', {
        method: 'POST',
        headers: authHeaders({ 'Content-Type': 'application/json' }),
        body: JSON.stringify({ amount: amount })
      });
      var data = await r.json().catch(function () { return {}; });
      if (!r.ok) {
        var msg = data.detail || '–ü–æ–º–∏–ª–∫–∞';
        if (msg.includes('–Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ')) {
          msg = 'TON wallet –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.';
        }
        if (tg) tg.showAlert(msg);
        else alert(msg);
        return;
      }
      if (data.test_mode) {
        if (tg) tg.showAlert('–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º): +' + amount + ' USDT');
        await loadMe();
      } else if (data.payment_link) {
        var linkTk = data.payment_link;
        var linkTg = data.payment_link_telegram || linkTk;
        var txId = data.transaction_id;
        var wallet = data.wallet || '';
        var comment = data.comment || '';
        window._depositLinks = { tk: linkTk, tg: linkTg, txId: txId, wallet: wallet, comment: comment };
        var modal = document.getElementById('depositChoiceModal');
        var addrEl = document.getElementById('depositModalAddress');
        var memoEl = document.getElementById('depositModalMemo');
        if (addrEl) addrEl.textContent = wallet;
        if (memoEl) memoEl.textContent = comment;
        if (modal) modal.style.display = 'flex';
        if (tg) tg.showAlert('–û–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è. –ü—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –±–∞–ª–∞–Ω—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.');
        setTimeout(function () { checkTransactionStatus(txId); }, 5000);
      } else {
        if (tg) tg.showAlert('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏');
      }
    } catch (e) {
      if (tg) tg.showAlert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + e.message);
      else alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + e.message);
    }
  }

  async function requestWithdraw(amount) {
    try {
      var r = await fetch(baseUrl + '/api/withdraw', {
        method: 'POST',
        headers: authHeaders({ 'Content-Type': 'application/json' }),
        body: JSON.stringify({ amount: amount })
      });
      var data = await r.json().catch(function () { return {}; });
      if (!r.ok) {
        if (tg) tg.showAlert(data.detail || '–ü–æ–º–∏–ª–∫–∞');
        return;
      }
      if (tg) tg.showAlert('–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω. –ü–µ—Ä–µ–≤–µ–¥–µ–º –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
      await loadMe();
    } catch (e) {
      if (tg) tg.showAlert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
    }
  }

  async function checkTransactionStatus(txId) {
    try {
      var r = await fetch(baseUrl + '/api/check_transaction/' + txId, {
        headers: authHeaders()
      });
      var data = await r.json().catch(function () { return {}; });
      if (data.confirmed) {
        if (tg) tg.showAlert('–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞! –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω.');
        await loadMe();
      } else {
        setTimeout(function () { checkTransactionStatus(txId); }, 5000);
      }
    } catch (e) {
      console.error('Check transaction error:', e);
    }
  }

  var ACHIEVEMENT_LABELS = {
    first_bet: '–ü–µ—Ä–≤–∞—è —Å—Ç–∞–≤–∫–∞',
    first_loss: '–ü–µ—Ä–≤–∞—è –ø—Ä–æ–∏–≥—Ä–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞',
    cashed_out_100: '–ó–∞–±—Ä–∞–ª 100+ USDT',
    cashed_out_500: '–ó–∞–±—Ä–∞–ª 500+ USDT',
    survived_5_rounds: '–ü—Ä–æ—à–µ–ª 5 —Ç—É—Ä–æ–≤'
  };

  function renderAchievements(achievements) {
    const el = document.getElementById('profileAchievements');
    if (!el) return;
    const keys = Object.keys(ACHIEVEMENT_LABELS);
    const unlockedSet = new Set((achievements || []).map(function (a) { return a.key; }));
    if (keys.length === 0) {
      el.innerHTML = '<p class="hint">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.</p>';
      return;
    }
    el.innerHTML = keys.map(function (key) {
      const unlocked = unlockedSet.has(key);
      const label = ACHIEVEMENT_LABELS[key] || key;
      return '<span class="achievement-badge' + (unlocked ? '' : ' locked') + '" title="' + escapeHtml(label) + '">' +
        '<span class="icon">' + (unlocked ? 'üèÜ' : 'üîí') + '</span>' +
        '<span>' + escapeHtml(label) + '</span>' +
      '</span>';
    }).join('');
  }

  const STAKE_OPTIONS = [0.1, 0.2, 0.5, 1, 2, 5];

  function fillStakeSelect(balance) {
    const sel = document.getElementById('joinStake');
    if (!sel) return;
    const bal = Number(balance);
    let opts = '<option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É ‚Äî</option>';
    STAKE_OPTIONS.forEach(function (v) {
      if (v <= bal) opts += '<option value="' + v + '">' + v + ' USDT</option>';
    });
    sel.innerHTML = opts;
    if (bal < 0.1) {
      opts += '<option value="" disabled>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ USDT (–º–∏–Ω. 0.1)</option>';
      sel.innerHTML = opts;
    }
  }

  function fillJoinGameSelect(games) {
    const sel = document.getElementById('joinGameId');
    if (!sel) return;
    const opts = games.map(g => '<option value="' + g.id + '">' + escapeHtml(g.title) + ' ¬∑ —Ä–∞—É–Ω–¥ ' + g.current_round + '</option>').join('');
    sel.innerHTML = '<option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ‚Äî</option>' + opts;
  }

  function escapeHtml(s) {
    const d = document.createElement('div');
    d.textContent = s;
    return d.innerHTML;
  }

  function fillGamesSelects(games) {
    const opts = games.map(g => '<option value="' + g.id + '">' + escapeHtml(g.title) + ' ¬∑ —Ä–∞—É–Ω–¥ ' + g.current_round + '</option>').join('');
    document.getElementById('setTeamsGameId').innerHTML = '<option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ‚Äî</option>' + opts;
    document.getElementById('addMatchGameId').innerHTML = '<option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É ‚Äî</option>' + opts;
    if (games.length === 1) {
      document.getElementById('setTeamsGameId').value = games[0].id;
      document.getElementById('addMatchGameId').value = games[0].id;
    }
  }

  function renderGamesList(games) {
    const el = document.getElementById('gamesList');
    if (!games.length) {
      el.innerHTML = '<div class="card game-card-admin"><span class="meta">–ò–≥—Ä –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –∏–≥—Ä—É –≤—ã—à–µ.</span></div>';
      fillGamesSelects(games);
      return;
    }
    el.innerHTML = games.map(g =>
      '<div class="card game-card-admin">' +
        '<div class="name">' + escapeHtml(g.title) + '</div>' +
        '<div class="meta">–†–∞—É–Ω–¥ ' + g.current_round + ' –∏–∑ ' + g.rounds_total + ' ¬∑ ' + g.status + '</div>' +
      '</div>'
    ).join('');
    fillGamesSelects(games);
  }

  function renderEntriesList(entries, games) {
    const webAppUrl = baseUrl + '/select_teams';
    const el = document.getElementById('entriesList');
    if (!entries.length) {
      el.innerHTML = '<p class="hint">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –≤—ã—à–µ, —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è¬ª.</p>';
      return;
    }
    el.innerHTML = entries.map(e => {
      const canPick = e.status === 'active';
      const link = canPick ? (webAppUrl + '?entry_id=' + e.entry_id) : '#';
      const cardClass = 'entry-card' + (canPick ? '' : ' disabled');
      let ctaText = '–ñ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
      if (canPick) ctaText = '–í—ã–±—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã';
      else if (e.status === 'cashed_out') ctaText = '–í—ã–∏–≥—Ä—ã—à –∑–∞–±—Ä–∞–Ω';
      else if (e.status === 'out') ctaText = '–í—ã –≤—ã–±—ã–ª–∏';
      const ctaIcon = canPick ? '‚öΩ' : (e.status === 'cashed_out' ? 'üèÜ' : '‚è≥');
      const stakeStr = e.stake != null ? ' ¬∑ ' + (Number(e.stake) % 1 === 0 ? e.stake : Number(e.stake).toFixed(2)) + ' USDT' : '';
      return '<a href="' + link + '" class="' + cardClass + '">' +
        '<div class="game-name">' + escapeHtml(e.game_title) + '</div>' +
        '<div class="meta">–†–∞—É–Ω–¥ ' + e.current_round + ' –∏–∑ ' + e.rounds_total + stakeStr + '</div>' +
        '<span class="cta">' + ctaIcon + ' ' + ctaText + '</span>' +
      '</a>';
    }).join('');
  }

  async function joinGame() {
    const gameId = document.getElementById('joinGameId').value;
    const stakeEl = document.getElementById('joinStake');
    const numTicketsEl = document.getElementById('joinNumTickets');
    const stakeVal = stakeEl && stakeEl.value ? parseFloat(stakeEl.value) : null;
    const numTickets = numTicketsEl && numTicketsEl.value ? parseInt(numTicketsEl.value, 10) : 1;
    if (!gameId) {
      if (tg) tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É');
      return;
    }
    if (!stakeVal || stakeVal < 0.1) {
      if (tg) tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏ (–º–∏–Ω. 0.1 USDT)');
      return;
    }
    try {
      const r = await fetch(baseUrl + '/api/join_game', {
        method: 'POST',
        headers: authHeaders({ 'Content-Type': 'application/json' }),
        body: JSON.stringify({ game_id: parseInt(gameId, 10), stake: stakeVal, num_tickets: numTickets })
      });
      const data = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(data.detail || '–û—à–∏–±–∫–∞');
      if (tg) tg.showAlert('–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∏–≥—Ä–µ. –ë–∏–ª–µ—Ç–æ–≤: ' + (data.num_tickets || numTickets));
      loadMe();
    } catch (e) {
      if (tg) tg.showAlert(e.message);
    }
  }

  async function createGame() {
    const title = document.getElementById('newGameTitle').value.trim();
    if (!title) { if (tg) tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã'); return; }
    try {
      const r = await fetch(baseUrl + '/api/games', { method: 'POST', headers: authHeaders({ 'Content-Type': 'application/json' }), body: JSON.stringify({ title }) });
      const data = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(data.detail || '–û—à–∏–±–∫–∞');
      if (tg) tg.showAlert('–ò–≥—Ä—É —Å–æ–∑–¥–∞–Ω–æ: ' + data.title);
      document.getElementById('newGameTitle').value = '';
      loadMe();
    } catch (e) {
      if (tg) tg.showAlert(e.message);
    }
  }

  async function setTeams() {
    const errEl = document.getElementById('setTeamsError');
    const previewEl = document.getElementById('setTeamsPreview');
    errEl.style.display = 'none';
    errEl.textContent = '';
    previewEl.style.display = 'none';
    const gameId = document.getElementById('setTeamsGameId').value;
    const text = document.getElementById('setTeamsText').value;
    if (!gameId) {
      errEl.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ.';
      errEl.style.display = 'block';
      if (tg) tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É');
      return;
    }
    const team_names = text.split('\n').map(l => l.trim()).filter(Boolean);
    if (team_names.length !== 20) {
      errEl.textContent = '–ù—É–∂–Ω–æ —Ä–æ–≤–Ω–æ 20 –∫–æ–º–∞–Ω–¥ (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É). –°–µ–π—á–∞—Å: ' + team_names.length;
      errEl.style.display = 'block';
      if (tg) tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Ä–æ–≤–Ω–æ 20 –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–º–∞–Ω–¥');
      return;
    }
    try {
      const r = await fetch(baseUrl + '/api/games/' + gameId + '/set_teams', {
        method: 'POST',
        headers: authHeaders({ 'Content-Type': 'application/json' }),
        body: JSON.stringify({ team_names })
      });
      const data = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(typeof data.detail === 'string' ? data.detail : '–û—à–∏–±–∫–∞');
      if (tg) tg.showAlert('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ 10 —Ç—É—Ä–æ–≤ –ø–æ 10 –º–∞—Ç—á–µ–π. –°—Ç–∞—Ä—ã–µ –º–∞—Ç—á–∏ –∏–≥—Ä—ã –∑–∞–º–µ–Ω–µ–Ω—ã.');
      previewEl.style.display = 'block';
      previewEl.innerHTML = '<div class="preview-title">–ì–æ—Ç–æ–≤–æ: 10 —Ç—É—Ä–æ–≤, –≤ –∫–∞–∂–¥–æ–º –ø–æ 10 –º–∞—Ç—á–µ–π (–ø–∞—Ä—ã –ø–µ—Ä–µ–º–µ—à–∞–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—É—Ä–∞).</div>';
      loadMe();
    } catch (e) {
      errEl.textContent = e.message;
      errEl.style.display = 'block';
      if (tg) tg.showAlert(e.message);
    }
  }

  async function fetchBundesligaRound() {
    const errEl = document.getElementById('fetchBl1Error');
    errEl.style.display = 'none';
    errEl.textContent = '';
    try {
      const r = await fetch(baseUrl + '/api/admin/fetch_bundesliga_round', { method: 'POST', headers: authHeaders() });
      const data = await r.json().catch(function () { return {}; });
      if (!r.ok) {
        errEl.textContent = data.detail || '–û—à–∏–±–∫–∞';
        errEl.style.display = 'block';
        if (tg) tg.showAlert(data.detail || '–û—à–∏–±–∫–∞');
        return;
      }
      if (tg) tg.showAlert('–ì–æ—Ç–æ–≤–æ: ' + (data.title || 'Bundesliga') + ', —Ç—É—Ä ' + data.matchday + ', –º–∞—Ç—á–µ–π: ' + (data.matches_count || 0));
      loadMe();
    } catch (e) {
      errEl.textContent = e.message;
      errEl.style.display = 'block';
      if (tg) tg.showAlert(e.message);
    }
  }

  async function adminConfirmDeposit() {
    const errEl = document.getElementById('adminConfirmError');
    const okEl = document.getElementById('adminConfirmSuccess');
    if (errEl) { errEl.style.display = 'none'; errEl.textContent = ''; }
    if (okEl) { okEl.style.display = 'none'; okEl.textContent = ''; }
    const txId = (document.getElementById('adminConfirmTxId') || {}).value.trim();
    const userIdEl = document.getElementById('adminConfirmUserId');
    const amountEl = document.getElementById('adminConfirmAmount');
    const userId = userIdEl ? parseInt(userIdEl.value, 10) : NaN;
    const amount = amountEl ? parseFloat(amountEl.value) : NaN;
    if (!txId) {
      if (errEl) { errEl.textContent = '–í–≤–µ–¥–∏—Ç–µ Transaction ID'; errEl.style.display = 'block'; }
      if (tg) tg.showAlert('–í–≤–µ–¥–∏—Ç–µ Transaction ID');
      return;
    }
    if (!userId || isNaN(userId)) {
      if (errEl) { errEl.textContent = '–í–≤–µ–¥–∏—Ç–µ Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'; errEl.style.display = 'block'; }
      if (tg) tg.showAlert('–í–≤–µ–¥–∏—Ç–µ Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
      return;
    }
    if (!amount || isNaN(amount) || amount < 0.1) {
      if (errEl) { errEl.textContent = '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–µ –º–µ–Ω–µ–µ 0.1 USDT'; errEl.style.display = 'block'; }
      if (tg) tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–µ –º–µ–Ω–µ–µ 0.1 USDT');
      return;
    }
    try {
      const r = await fetch(baseUrl + '/api/admin/confirm_deposit?tx_id=' + encodeURIComponent(txId) + '&user_id=' + userId + '&amount=' + amount, {
        method: 'POST',
        headers: authHeaders()
      });
      const data = await r.json().catch(function () { return {}; });
      if (!r.ok) {
        if (errEl) { errEl.textContent = data.detail || '–û—à–∏–±–∫–∞'; errEl.style.display = 'block'; }
        if (tg) tg.showAlert(data.detail || '–û—à–∏–±–∫–∞');
        return;
      }
      if (okEl) { okEl.textContent = '–ó–∞—á–∏—Å–ª–µ–Ω–æ ' + amount + ' USDT. –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + (data.balance != null ? data.balance : '‚Äî'); okEl.style.display = 'block'; }
      if (tg) tg.showAlert('–î–µ–ø–æ–∑–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω: +' + amount + ' USDT');
      document.getElementById('adminConfirmTxId').value = '';
      if (amountEl) amountEl.value = '';
    } catch (e) {
      if (errEl) { errEl.textContent = e.message || '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'; errEl.style.display = 'block'; }
      if (tg) tg.showAlert(e.message || '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
    }
  }

  async function addMatches() {
    const errEl = document.getElementById('addMatchError');
    errEl.style.display = 'none';
    errEl.textContent = '';
    const gameId = document.getElementById('addMatchGameId').value;
    const round = parseInt(document.getElementById('addMatchRound').value, 10);
    const text = document.getElementById('addMatchText').value;
    if (!gameId) {
      errEl.textContent = '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ.';
      errEl.style.display = 'block';
      if (tg) tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞ ¬´–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É¬ª');
      return;
    }
    if (!round || round < 1) {
      errEl.textContent = '–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Ä–∞—É–Ω–¥–∞ (1, 2, 3...).';
      errEl.style.display = 'block';
      return;
    }
    const lines = text.split('\n').map(l => l.trim()).filter(Boolean);
    if (!lines.length) {
      errEl.textContent = '–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –º–∞—Ç—á –≤ —Ñ–æ—Ä–º–∞—Ç–µ: –î–æ–º–∞ ‚Äî –ì–æ—Å—Ç—å (–æ–¥–∏–Ω –Ω–∞ —Å—Ç—Ä–æ–∫—É).';
      errEl.style.display = 'block';
      if (tg) tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –º–∞—Ç—á–∏ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ');
      return;
    }
    try {
      const r = await fetch(baseUrl + '/api/games/' + gameId + '/matches', { method: 'POST', headers: authHeaders({ 'Content-Type': 'application/json' }), body: JSON.stringify({ round, matches: lines }) });
      const data = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(data.detail || '–ü–æ–º–∏–ª–∫–∞');
      const added = data.added || 0;
      const notFound = data.not_found || [];
      if (notFound.length > 0) {
        errEl.textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ): ' + notFound.slice(0, 8).join(', ') + (notFound.length > 8 ? '‚Ä¶' : '');
        errEl.style.display = 'block';
      }
      if (added > 0) {
        if (tg) tg.showAlert('–î–æ–±–∞–≤–ª–µ–Ω–æ –º–∞—Ç—á–µ–π: ' + added + (notFound.length ? '. –ß–∞—Å—Ç—å –Ω–µ –¥–æ–±–∞–≤–∏–ª–∞—Å—å ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π.' : ''));
        document.getElementById('addMatchText').value = '';
      } else if (notFound.length === 0) {
        if (tg) tg.showAlert('–ù–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç: –î–æ–º–∞ ‚Äî –ì–æ—Å—Ç—å –Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É.');
      }
      loadMe();
      if (added > 0) {
        const listR = await fetch(baseUrl + '/api/games/' + gameId + '/matches?round=' + round, { headers: authHeaders() });
        const listData = await listR.json().catch(() => []);
        const preview = document.getElementById('matchesAddedPreview');
        if (listR.ok && Array.isArray(listData) && listData.length > 0) {
          preview.style.display = 'block';
          preview.innerHTML = '<div class="preview-title">–ú–∞—Ç—á–∏ —ç—Ç–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (–æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏–≥—Ä–æ–∫–∞–º):</div>' +
            listData.map(m => '<div class="match-line"><span class="team-name">' + escapeHtml(m.home) + '</span> ‚öîÔ∏è <span class="team-name">' + escapeHtml(m.away) + '</span></div>').join('');
        } else {
          preview.style.display = 'block';
          preview.innerHTML = '<div class="preview-title">–î–æ–±–∞–≤–ª–µ–Ω–æ ' + added + ' –º–∞—Ç—á–µ–π. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –≤—ã–±–æ—Ä–µ –∏–≥—Ä–æ–∫–æ–≤.</div>';
        }
      }
    } catch (e) {
      if (tg) tg.showAlert(e.message);
    }
  }

  async function loadMe() {
    if (!initData) {
      showError('–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ —á–∞—Ç–∞ –±–æ—Ç–∞ @PriceCalculatorNL_bot (–∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é –∏–ª–∏ /start), –∞ –Ω–µ –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.');
      return;
    }
    try {
      const r = await fetch(baseUrl + '/api/me', { headers: authHeaders() });
      const data = await r.json().catch(() => ({}));
      if (!r.ok) {
        const msg = data.detail || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
        showError(msg + '\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–º–µ–Ω–Ω–æ –∏–∑ –±–æ—Ç–∞ @PriceCalculatorNL_bot. –ï—Å–ª–∏ –≤—ã –∑–∞—à–ª–∏ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞ ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.');
        return;
      }
      showContent(data);
      // Update balance in bets section if user is not admin
      if (!data.is_admin) {
        const balance = data.balance != null ? Number(data.balance) : 0;
        const betsBalanceEl = document.getElementById('betsBalanceValue');
        if (betsBalanceEl) {
          betsBalanceEl.textContent = balance % 1 === 0 ? balance : balance.toFixed(2);
        }
        const balanceZeroMsg = document.getElementById('balanceZeroMessage');
        if (balanceZeroMsg) {
          balanceZeroMsg.style.display = balance === 0 ? 'block' : 'none';
        }
      }
    } catch (e) {
      showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + e.message);
    }
  }

  // –ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–Ω—è—Ç–Ω–æ¬ª –∏ –∫–Ω–æ–ø–∫–∞ ¬´–ü—Ä–∞–≤–∏–ª–∞¬ª –≤ —à–∞–ø–∫–µ
  (function initRulesModal() {
    var rulesModal = document.getElementById('rulesModal');
    var rulesCloseBtn = document.getElementById('rulesCloseBtn');
    var btnShowRules = document.getElementById('btnShowRules');
    if (!rulesModal || !rulesCloseBtn) return;
    rulesCloseBtn.addEventListener('click', function() {
      rulesModal.classList.add('hide');
      setTimeout(function() {
        rulesModal.style.display = 'none';
      }, 300);
      localStorage.setItem('rulesShown', 'true');
    });
    if (btnShowRules) {
      btnShowRules.addEventListener('click', function() {
        rulesModal.classList.remove('hide');
        rulesModal.style.display = 'flex';
      });
    }
  })();

  // Check if rules were shown before
  function showRulesIfNeeded() {
    var rulesModal = document.getElementById('rulesModal');
    if (!rulesModal) return;
    var rulesShown = localStorage.getItem('rulesShown');
    if (!rulesShown) {
      rulesModal.classList.remove('hide');
      rulesModal.style.display = 'flex';
    } else {
      rulesModal.style.display = 'none';
    }
  }

  loadMe();
  setTimeout(function () {
    var splash = document.getElementById('splash');
    var main = document.getElementById('mainContainer');
    if (splash) splash.classList.add('hide');
    if (main) main.style.opacity = '1';
    setTimeout(function() {
      showRulesIfNeeded();
    }, 500);
  }, 2500);
})();
  </script>
</body>
</html>
